<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.3 Scraping: Messy and Mangled | R Module 2</title>
  <meta name="description" content="This is the second installment for the book for the R Intro Course at CSU." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="2.3 Scraping: Messy and Mangled | R Module 2" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the second installment for the book for the R Intro Course at CSU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.3 Scraping: Messy and Mangled | R Module 2" />
  
  <meta name="twitter:description" content="This is the second installment for the book for the R Intro Course at CSU." />
  

<meta name="author" content="Connor Gibbs" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="apis-clean-and-curated.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="src\style.css" type="text/css" />
<link rel="stylesheet" href="src\environments.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Module 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a><ul>
<li class="chapter" data-level="1.0.1" data-path="index.html"><a href="index.html#how-to-navigate-this-book"><i class="fa fa-check"></i><b>1.0.1</b> How To Navigate This Book</a></li>
<li class="chapter" data-level="1.1" data-path="associated-csu-course.html"><a href="associated-csu-course.html"><i class="fa fa-check"></i><b>1.1</b> Associated CSU Course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="AccessingData.html"><a href="AccessingData.html"><i class="fa fa-check"></i><b>2</b> Accessing Data</a><ul>
<li class="chapter" data-level="2.1" data-path="rectangular-vs-non-rectangular-data.html"><a href="rectangular-vs-non-rectangular-data.html"><i class="fa fa-check"></i><b>2.1</b> Rectangular vs.Â Non-rectangular Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="rectangular-vs-non-rectangular-data.html"><a href="rectangular-vs-non-rectangular-data.html#reading-and-writing-rectangular-data"><i class="fa fa-check"></i><b>2.1.1</b> Reading and Writing Rectangular Data</a></li>
<li class="chapter" data-level="2.1.2" data-path="rectangular-vs-non-rectangular-data.html"><a href="rectangular-vs-non-rectangular-data.html#reading-and-writing-non-rectangular-data"><i class="fa fa-check"></i><b>2.1.2</b> Reading and Writing Non-rectangular Data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="apis-clean-and-curated.html"><a href="apis-clean-and-curated.html"><i class="fa fa-check"></i><b>2.2</b> APIs: Clean and Curated</a></li>
<li class="chapter" data-level="2.3" data-path="scraping-messy-and-mangled.html"><a href="scraping-messy-and-mangled.html"><i class="fa fa-check"></i><b>2.3</b> Scraping: Messy and Mangled</a><ul>
<li class="chapter" data-level="2.3.1" data-path="scraping-messy-and-mangled.html"><a href="scraping-messy-and-mangled.html#scraping-vs-api"><i class="fa fa-check"></i><b>2.3.1</b> Scraping vs API</a></li>
<li class="chapter" data-level="2.3.2" data-path="scraping-messy-and-mangled.html"><a href="scraping-messy-and-mangled.html#hypertext-markup-language-html"><i class="fa fa-check"></i><b>2.3.2</b> Hypertext Markup Language (HTML)</a></li>
<li class="chapter" data-level="2.3.3" data-path="scraping-messy-and-mangled.html"><a href="scraping-messy-and-mangled.html#selector-gadgets"><i class="fa fa-check"></i><b>2.3.3</b> Selector Gadgets</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Module 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scraping-messy-and-mangled" class="section level2">
<h2><span class="header-section-number">2.3</span> Scraping: Messy and Mangled</h2>
<p>If you are reading this textbook, at some point in your career, you are likely to want or need data which exists on the web. You have looked for downloadable sources and Google searched for an API, but alas, no luck. The last resort for importing data into <code>R</code> is <strong>web scraping</strong>. Web scraping is a technique for harvesting data which is portrayed on the web and exists in hypertext markup language (HTML), the language of web browser documents.</p>
<div id="scraping-vs-api" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Scraping vs API</h3>
<p>The benefit of using an API are clean data. For example, we can traverse the result to find the latest NFL events.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r chunk-style"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">head</span>(bov_res[[<span class="dv">2</span>]][[<span class="dv">1</span>]][,<span class="dv">2</span>])</a></code></pre></div>
<pre class="output-style"><code>[1] &quot;Kansas City Chiefs @ Baltimore Ravens&quot;    
[2] &quot;Denver Broncos @ New York Jets&quot;           
[3] &quot;Arizona Cardinals @ Carolina Panthers&quot;    
[4] &quot;Cleveland Browns @ Dallas Cowboys&quot;        
[5] &quot;Indianapolis Colts @ Chicago Bears&quot;       
[6] &quot;Jacksonville Jaguars @ Cincinnati Bengals&quot;</code></pre>
<p>With more digging, we can find which teams are playing at home.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r chunk-style"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">head</span>(bov_res[[<span class="dv">2</span>]][[<span class="dv">1</span>]][[<span class="dv">16</span>]])</a></code></pre></div>
<pre class="output-style"><code>[[1]]
                id               name  home
1 7712412-11903831   Baltimore Ravens  TRUE
2 7712412-11852811 Kansas City Chiefs FALSE

[[2]]
                id           name  home
1 7736035-11904241  New York Jets  TRUE
2 7736035-11904245 Denver Broncos FALSE

[[3]]
                id              name  home
1 7736038-11904216 Carolina Panthers  TRUE
2 7736038-11904247 Arizona Cardinals FALSE

[[4]]
                id             name  home
1 7736033-11904234   Dallas Cowboys  TRUE
2 7736033-11904219 Cleveland Browns FALSE

[[5]]
                id               name  home
1 7736053-11903832      Chicago Bears  TRUE
2 7736053-11904232 Indianapolis Colts FALSE

[[6]]
                id                 name  home
1 7736109-11904217   Cincinnati Bengals  TRUE
2 7736109-11904220 Jacksonville Jaguars FALSE</code></pre>
<p>We can also find the current line of each of these games. Here, I have created a function called <code>get_bovada_lines()</code> which traverses this complicated (yet clean) JSON object using methods explored in Chapter 3 and combines the information together into a rectangular data set.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r chunk-style"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">head</span>(<span class="kw">get_bovada_lines</span>(<span class="dt">bov_json =</span> bov_res))</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["link"],"name":[2],"type":["chr"],"align":["left"]},{"label":["description"],"name":[3],"type":["chr"],"align":["left"]},{"label":["startTime"],"name":[4],"type":["S3: POSIXct"],"align":["right"]},{"label":["live"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["type"],"name":[6],"type":["chr"],"align":["left"]},{"label":["lastModified"],"name":[7],"type":["S3: POSIXct"],"align":["right"]},{"label":["team_id"],"name":[8],"type":["chr"],"align":["left"]},{"label":["name"],"name":[9],"type":["chr"],"align":["left"]},{"label":["home"],"name":[10],"type":["lgl"],"align":["right"]},{"label":["juice_money"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["handicap_spread"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["juice_spread"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["handicap_total"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["juice_over"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["juice_under"],"name":[16],"type":["dbl"],"align":["right"]}],"data":[{"1":"7712412","2":"/football/nfl/kansas-city-chiefs-baltimore-ravens-202009282015","3":"Kansas City Chiefs @ Baltimore Ravens","4":"2020-09-28 17:15:00","5":"FALSE","6":"GAMEEVENT","7":"2020-09-28 11:00:41","8":"11903831","9":"Baltimore Ravens","10":"TRUE","11":"1.625000","12":"-3","13":"1.833333","14":"55.5","15":"1.909091","16":"1.909091"},{"1":"7712412","2":"/football/nfl/kansas-city-chiefs-baltimore-ravens-202009282015","3":"Kansas City Chiefs @ Baltimore Ravens","4":"2020-09-28 17:15:00","5":"FALSE","6":"GAMEEVENT","7":"2020-09-28 11:00:41","8":"11852811","9":"Kansas City Chiefs","10":"FALSE","11":"2.400000","12":"3","13":"2.000000","14":"55.5","15":"1.909091","16":"1.909091"},{"1":"7736035","2":"/football/nfl/denver-broncos-new-york-jets-202010012020","3":"Denver Broncos @ New York Jets","4":"2020-10-01 17:20:00","5":"FALSE","6":"GAMEEVENT","7":"2020-09-28 10:10:37","8":"11904241","9":"New York Jets","10":"TRUE","11":"2.450000","12":"3","13":"1.909091","14":"40.0","15":"1.909091","16":"1.909091"},{"1":"7736035","2":"/football/nfl/denver-broncos-new-york-jets-202010012020","3":"Denver Broncos @ New York Jets","4":"2020-10-01 17:20:00","5":"FALSE","6":"GAMEEVENT","7":"2020-09-28 10:10:37","8":"11904245","9":"Denver Broncos","10":"FALSE","11":"1.606061","12":"-3","13":"1.909091","14":"40.0","15":"1.909091","16":"1.909091"},{"1":"7736038","2":"/football/nfl/arizona-cardinals-carolina-panthers-202010041300","3":"Arizona Cardinals @ Carolina Panthers","4":"2020-10-04 10:00:00","5":"FALSE","6":"GAMEEVENT","7":"2020-09-28 10:44:56","8":"11904216","9":"Carolina Panthers","10":"TRUE","11":"2.700000","12":"4","13":"1.870000","14":"52.0","15":"1.909091","16":"1.909091"},{"1":"7736038","2":"/football/nfl/arizona-cardinals-carolina-panthers-202010041300","3":"Arizona Cardinals @ Carolina Panthers","4":"2020-10-04 10:00:00","5":"FALSE","6":"GAMEEVENT","7":"2020-09-28 10:44:56","8":"11904247","9":"Arizona Cardinals","10":"FALSE","11":"1.500000","12":"-4","13":"1.952381","14":"52.0","15":"1.909091","16":"1.909091"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>While traversing these sometimes complicated lists may seem intimidating, with practice, working with data from an API will be made easier after discussing mapping functions in Chapter 3 which are useful for traversing complicated lists. Hopefully, after the scraping section, you will find working with APIs like a walk in the park compared to scraping data directly from the web.</p>
</div>
<div id="hypertext-markup-language-html" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Hypertext Markup Language (HTML)</h3>
<p>Web sites are written in hypertext markup language. All contents that are displayed on a web page are structured through HTML with the help of HTML <strong>elements</strong>. HTML elements consist of a tag and contents. The <strong>tag</strong> defines how the web browser should format and display the content. Aptly, the <strong>content</strong> is what should be displayed.</p>
<p>For example, if we wished to format text as a paragraph within the web document, then we could use the paragraph tag, <code>&lt;p&gt;</code>, to indicate the beginning of a paragraph. After opening a tag, we then specify the content to display before closing the tag. A complete paragraph may read:</p>
<p><code>&lt;p&gt; This is the paragraph you want to scrape. &lt;/p&gt;</code></p>
<p><strong>Attributes</strong> are optional parameters which provide additional information about the element in which the attribute is included. For example, within the paragraph tag, you can define a class attribute which formats the text in a specific way, such as bolding, coloring, or aligning the text. To extend our example, the element may read:</p>
<p><code>&lt;p class = "fancy"&gt; This is the paragraph you want to scrape which has been formatted in a fancy script. &lt;/p&gt;</code></p>
<p>The type of attribute, being class, is the attribute <strong>name</strong>, whereas the quantity assigned to the attribute, being fancy, is the attribute <strong>value</strong>. The general decomposition of an HTML element is characterized by the following figure:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-24"></span>
<img src="src/images/element_decomp.jpg" alt="the lingo of an HTML element" width="442" />
<p class="caption">
Figure 2.1: the lingo of an HTML element
</p>
</div>
<div class="bonus">
<p>
The class attribute is a flexible one. Many web developers use the class attribute to point to a class name in a style sheet or to access and manipulate elements with the specifc class name with a JavaScript. For more information of the class attribute, see this <a href="https://www.w3schools.com/html/html_classes.asp">link</a>. For more information on cascading style sheets which are used to decorate HTML pages, see this <a href="https://www.w3schools.com/css/">link</a>.
</p>
</div>
<div class="feedback">
<p>
Any feedback for this section? Click <a href="https://docs.google.com/forms/d/e/1FAIpQLSePQZ3lIaCIPo9J2owXImHZ_9wBEgTo21A0s-A1ty28u4yfvw/viewform?entry.1684471501=The%20R%20Community">here</a>
</p>
</div>
</div>
<div id="selector-gadgets" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Selector Gadgets</h3>
<p>In the previous section, we introduced HTML elements. While all web pages are composed of HTML elements, the elements themselves can be structured in complicated ways. Elements are often nested inside one another or make use of elements in other documents. These complicated structures can make scraping data difficult. Thankfully, we can circumvent exploring these complicated structures with the help of selector gadgets.</p>
<p>A <strong>selector gadget</strong> allows you to determine what css selector you need to extract the information desired from a webpage. These JavaScript bookmarklets allow you to determine where the information you desire belongs within the complicated struture of elements that makeup a webpage. To follow along in Chapter 3, you will need to download one of these gadgets from this <a href="https://selectorgadget.com/">link</a>. If you use Google Chrome, you can download the bookmark extension directly from this <a href="https://selectorgadget.com/">link</a>.</p>

</div>
</div>
<!-- </div> -->






            </section>

          </div>
        </div>
      </div>
<a href="apis-clean-and-curated.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Module2.pdf", "Module2.epub"],
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

</body>

</html>
